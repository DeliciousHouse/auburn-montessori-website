---
import Layout from '../layouts/Layout.astro';
import fees from '../data/fees-hours.json';

function formatDate(iso: string): string {
  if (!iso) return iso;
  try {
    const d = new Date(iso);
    return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
  } catch { return iso; }
}

const mealPlanRows = fees.programs.flatMap((p) =>
  p.mealPlanOptions.map((m) => ({ program: p.name, hours: p.hours, option: m.name, amount: m.amountPerYear, notes: m.notes }))
);
---

<Layout
  title="Fees & Hours"
  description="Hours of operation, tuition, fees, and policies for Auburn Montessori School - The Children's House."
  heroTitle="Fees & Hours"
  heroLead="Fee and schedule information for Auburn Montessori School. For the full details, download the official PDF."
>
  <!-- Term badge + PDF download -->
  <div class="section-band">
    <div class="container-page">
      <div class="flex flex-wrap items-center gap-3">
        <span class="badge badge-brand">Term: {fees.term}</span>
        <a class="btn btn-outline btn-sm btn-icon" href={fees.pdfPath} download>
          <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M12 5v14m0 0l-5-5m5 5l5-5M5 19h14"/></svg>
          Download Official PDF
        </a>
      </div>

      <!-- Programs table -->
      <div class="mt-8">
        <h2 class="section-heading">Programs</h2>
        <p class="section-subheading">Hours, tuition, and enrollment fees by program</p>
        <div class="mt-5 overflow-x-auto rounded-xl border bg-white" style="border-color: var(--color-neutral-200);">
          <table class="data-table table-cards w-full min-w-[42rem]">
            <caption class="sr-only">Program hours, tuition, enrollment fee, and late pickup policy by program</caption>
            <thead>
              <tr>
                <th scope="col">Program</th>
                <th scope="col">Hours</th>
                <th scope="col">Monthly Tuition</th>
                <th scope="col">Annual Enrollment</th>
                <th scope="col">Enrollment Due</th>
                <th scope="col">Late Pickup</th>
              </tr>
            </thead>
            <tbody>
              {fees.programs.map((p) => (
                <tr>
                  <td data-label="Program" class="font-semibold" style="color: var(--color-neutral-900);">{p.name}</td>
                  <td data-label="Hours">{p.hours}</td>
                  <td data-label="Mo. Tuition">
                    <span class="font-semibold" style="color: var(--color-neutral-900);">${p.monthlyTuition}</span>
                    {p.tuitionNotes ? <span class="block text-xs" style="color: var(--color-neutral-500);">{p.tuitionNotes}</span> : null}
                  </td>
                  <td data-label="Enrollment">${p.annualEnrollmentFee}</td>
                  <td data-label="Due">{formatDate(p.annualEnrollmentFeeDue)}</td>
                  <td data-label="Late Pickup">{p.latePickupPolicy}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Meal Plan table -->
      <div class="mt-10">
        <h2 class="section-heading">Meal Plan</h2>
        <p class="section-subheading">{fees.mealProvider}</p>
        <div class="mt-5 overflow-x-auto rounded-xl border bg-white" style="border-color: var(--color-neutral-200);">
          <table class="data-table table-cards w-full min-w-[32rem]">
            <caption class="sr-only">Meal plan options and amounts by program</caption>
            <thead>
              <tr>
                <th scope="col">Program</th>
                <th scope="col">Hours</th>
                <th scope="col">Option</th>
                <th scope="col">Amount / Year</th>
                <th scope="col">Due</th>
              </tr>
            </thead>
            <tbody>
              {mealPlanRows.map((row) => (
                <tr>
                  <td data-label="Program">{row.program}</td>
                  <td data-label="Hours">{row.hours}</td>
                  <td data-label="Option" class="font-semibold" style="color: var(--color-neutral-900);">{row.option}</td>
                  <td data-label="Amount">${row.amount}</td>
                  <td data-label="Due">{row.notes}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Policies + Payment -->
  <div class="section-band-alt">
    <div class="container-page">
      <h2 class="section-heading">Policies</h2>
      <p class="section-subheading">Important policies regarding fees and schedule</p>

      <div class="mt-6 grid gap-5 md:grid-cols-3">
        <div class="callout callout-warn">
          <div class="callout-title">
            <span aria-hidden="true">‚è∞</span> Late Pick Up
          </div>
          <div class="callout-body">{fees.latePickUpFeePolicy}</div>
        </div>
        <div class="callout callout-warn">
          <div class="callout-title">
            <span aria-hidden="true">üí≥</span> Late Payment
          </div>
          <div class="callout-body">{fees.paymentFeePolicy}</div>
        </div>
        <div class="callout callout-warn">
          <div class="callout-title">
            <span aria-hidden="true">üìÑ</span> Returned Checks
          </div>
          <div class="callout-body">{fees.returnedChecksPolicy}</div>
        </div>
      </div>

      <div class="mt-8 grid gap-8 lg:grid-cols-2">
        <div class="card card-body">
          <h3 class="text-sm font-bold" style="color: var(--color-neutral-900);">Payment Agreement</h3>
          <ul class="mt-3 space-y-2 text-sm leading-relaxed" style="color: var(--color-neutral-700);">
            {fees.paymentAgreement.map((p) => (
              <li class="flex gap-2">
                <span class="shrink-0" style="color: var(--color-neutral-400);">‚Äî</span>
                <span>{p}</span>
              </li>
            ))}
          </ul>
        </div>

        <div class="card card-body">
          <h3 class="text-sm font-bold" style="color: var(--color-neutral-900);">Registration Fee</h3>
          <p class="mt-2 text-sm leading-relaxed" style="color: var(--color-neutral-700);">{fees.registrationFee.note}</p>

          <h3 class="mt-5 text-sm font-bold" style="color: var(--color-neutral-900);">Payment Options</h3>
          <ul class="mt-2 space-y-2 text-sm leading-relaxed" style="color: var(--color-neutral-700);">
            {fees.paymentOptions.map((p) => (
              <li class="flex gap-2">
                <span class="shrink-0" style="color: var(--color-neutral-400);">‚Äî</span>
                <span>{p}</span>
              </li>
            ))}
          </ul>

          <h3 class="mt-5 text-sm font-bold" style="color: var(--color-neutral-900);">Downloads</h3>
          <div class="mt-2 flex flex-wrap gap-2">
            {fees.sources.map((s) => (
              <a class="btn btn-outline btn-sm" href={s.href} download>{s.label}</a>
            ))}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF preview -->
  <div class="section-band">
    <div class="container-page">
      <details>
        <summary class="btn btn-ghost btn-sm cursor-pointer">Preview official PDF in browser</summary>
        <div class="mt-4 overflow-hidden rounded-xl border bg-white shadow-sm" style="border-color: var(--color-neutral-200);">
          <iframe
            title="Fees and Hours of Operation PDF viewer"
            src={`${fees.pdfPath}#view=FitH`}
            class="h-[65vh] w-full"
            loading="lazy"
          ></iframe>
        </div>
        <p class="mt-2 text-xs" style="color: var(--color-neutral-500);">If the viewer doesn't load, use the download button above.</p>
      </details>
    </div>
  </div>
</Layout>
