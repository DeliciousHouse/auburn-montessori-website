---
import Layout from '../layouts/Layout.astro';
import educatorsData from '../data/educators.json';
import site from '../data/site.json';
import ExternalLink from '../components/ExternalLink.astro';
import Accordion from '../components/Accordion.astro';
import PageNav from '../components/PageNav.astro';

const leadership = educatorsData.educators.filter((e) =>
  e.role?.toLowerCase().includes('director') || e.role?.toLowerCase().includes('founder')
);
const guides = educatorsData.educators.filter((e) =>
  e.role === 'Educator'
);
const support = educatorsData.educators.filter((e) =>
  e.role === 'Assistant Director' || e.role === 'Support Staff'
);

const pageNavLinks = [
  ...(leadership.length > 0 ? [{ id: 'leadership', label: 'Leadership' }] : []),
  ...(guides.length > 0 ? [{ id: 'lead-guides', label: 'Lead Guides' }] : []),
  ...(support.length > 0 ? [{ id: 'assistants-support', label: 'Assistants & Support' }] : []),
];

const getInitials = (name: string) =>
  (name || '')
    .split(/\s+/)
    .filter(Boolean)
    .slice(0, 2)
    .map((p) => (p[0] ?? '').toUpperCase())
    .join('');
---

<Layout
  title="Educators"
  description="Meet the educators and staff at Auburn Montessori School - The Children's House."
  heroTitle="Our Educators"
  heroLead="All teachers have completed necessary trainings including CPR, references, and background checks in compliance with Alabama DHR, Child Care Division."
>
  <div class="section-band">
    <div class="container-page">
      <p class="text-sm" style="color: var(--color-neutral-600);">
        For questions about our staff or programs, contact the school at
        <a class="font-semibold" href={`mailto:${site.email}`}>{site.email}</a> or
        <a class="font-semibold" href={`tel:${site.phone}`}>{site.phone}</a>.
      </p>

      <PageNav links={pageNavLinks} class="mt-6" />

      {leadership.length > 0 && (
        <div class="mt-8">
          <h2 id="leadership" class="section-heading">Leadership</h2>
          <div class="mt-4 grid gap-5">
            {leadership.map((e, idx) => (
              <article class="card card-body">
                <div class="flex flex-col gap-4 sm:flex-row sm:items-start">
                  <div class="shrink-0">
                    {e.photo?.src ? (
                      <div class="media-frame h-24 w-24 rounded-full border" style="border-color: var(--color-border);">
                        <img
                          src={e.photo.src}
                          alt={e.photo.alt ?? `Photo of ${e.name}`}
                          width="96"
                          height="96"
                          loading="lazy"
                          decoding="async"
                        />
                      </div>
                    ) : (
                      <div
                        class="flex h-24 w-24 items-center justify-center rounded-full border text-lg font-bold"
                        style="border-color: var(--color-border); background: var(--color-surface-alt); color: var(--color-primary);"
                        aria-hidden="true"
                      >
                        {getInitials(e.name)}
                      </div>
                    )}
                  </div>

                  <div class="min-w-0 flex-1">
                    <div class="flex flex-wrap items-center gap-3">
                      <h3 class="text-base font-bold" style="color: var(--color-neutral-900);">{e.name}</h3>
                      <span class="badge badge-brand">{e.role}</span>
                      {e.since ? <span class="badge">{e.since}</span> : null}
                    </div>

                    {(e.preferredName || e.pronouns || e.hours) && (
                      <div class="mt-2 flex flex-wrap gap-x-4 gap-y-1 text-xs" style="color: var(--color-neutral-500);">
                        {e.preferredName && <span>Goes by {e.preferredName}</span>}
                        {e.pronouns && <span>{e.pronouns}</span>}
                        {e.hours && <span>{e.hours}</span>}
                      </div>
                    )}

                    {e.bio?.length ? (
                      <p class="mt-3 text-sm leading-relaxed" style="color: var(--color-neutral-700);">{e.bio.join(' ')}</p>
                    ) : null}

                    <div class="mt-4 grid gap-3 md:grid-cols-2">
                      {e.education?.length ? (
                        <Accordion id={`leadership-${idx}-education`} class="border-b-0 border-t" style="border-color: var(--color-neutral-200);">
                          <span slot="title">Education ({e.education.length})</span>
                          <ul class="list-disc space-y-1 pl-5">{e.education.map((i) => <li>{i}</li>)}</ul>
                        </Accordion>
                      ) : null}

                      {e.credentialsAndTraining?.length ? (
                        <Accordion id={`leadership-${idx}-credentials`} class="border-b-0 border-t" style="border-color: var(--color-neutral-200);">
                          <span slot="title">Credentials ({e.credentialsAndTraining.length})</span>
                          <ul class="list-disc space-y-1 pl-5">{e.credentialsAndTraining.map((i) => <li>{i}</li>)}</ul>
                        </Accordion>
                      ) : null}
                    </div>

                    {e.links?.length ? (
                      <div class="mt-4 flex flex-wrap gap-2">
                        {e.links.map((l) =>
                          l.external ? (
                            <ExternalLink href={l.href} opensIn="new tab" class="chip">
                              {l.label}
                            </ExternalLink>
                          ) : (
                            <a class="chip" href={l.href}>{l.label}</a>
                          )
                        )}
                      </div>
                    ) : null}
                  </div>
                </div>
              </article>
            ))}
          </div>
        </div>
      )}

      {guides.length > 0 && (
        <div class="mt-10">
          <h2 id="lead-guides" class="section-heading">Lead Guides</h2>
          <p class="section-subheading">Classroom educators supporting daily Montessori instruction</p>
          <div class="mt-5 grid gap-5 md:grid-cols-2">
            {guides.map((e, idx) => (
              <article class="card card-body">
                <div class="flex flex-col gap-4 sm:flex-row sm:items-start">
                  <div class="shrink-0">
                    {e.photo?.src ? (
                      <div class="media-frame h-20 w-20 rounded-full border" style="border-color: var(--color-border);">
                        <img
                          src={e.photo.src}
                          alt={e.photo.alt ?? `Photo of ${e.name}`}
                          width="80"
                          height="80"
                          loading="lazy"
                          decoding="async"
                        />
                      </div>
                    ) : (
                      <div
                        class="flex h-20 w-20 items-center justify-center rounded-full border text-base font-bold"
                        style="border-color: var(--color-border); background: var(--color-surface-alt); color: var(--color-primary);"
                        aria-hidden="true"
                      >
                        {getInitials(e.name)}
                      </div>
                    )}
                  </div>

                  <div class="min-w-0 flex-1">
                    <div class="flex flex-wrap items-center gap-3">
                      <h3 class="text-sm font-bold" style="color: var(--color-neutral-900);">{e.name}</h3>
                      {e.since ? <span class="badge">{e.since}</span> : null}
                    </div>

                    {e.bio?.length ? (
                      <p class="mt-2 text-sm leading-relaxed" style="color: var(--color-neutral-700);">{e.bio.join(' ')}</p>
                    ) : null}

                    <div class="mt-3 space-y-2">
                      {e.education?.length ? (
                        <Accordion id={`guide-${idx}-education`} class="border-b-0">
                          <span slot="title">Education ({e.education.length})</span>
                          <ul class="list-disc space-y-1 pl-5">{e.education.map((i) => <li>{i}</li>)}</ul>
                        </Accordion>
                      ) : null}
                      {e.credentialsAndTraining?.length ? (
                        <Accordion id={`guide-${idx}-credentials`} class="border-b-0">
                          <span slot="title">Credentials ({e.credentialsAndTraining.length})</span>
                          <ul class="list-disc space-y-1 pl-5">{e.credentialsAndTraining.map((i) => <li>{i}</li>)}</ul>
                        </Accordion>
                      ) : null}
                    </div>
                  </div>
                </div>
              </article>
            ))}
          </div>
        </div>
      )}

      {support.length > 0 && (
        <div class="mt-10">
          <h2 id="assistants-support" class="section-heading">Assistants &amp; Support</h2>
          <div class="mt-5 grid gap-5 md:grid-cols-2 lg:grid-cols-3">
            {support.map((e) => (
              <article class="card card-body">
                <div class="flex flex-col gap-4 sm:flex-row sm:items-start">
                  <div class="shrink-0">
                    {e.photo?.src ? (
                      <div class="media-frame h-16 w-16 rounded-full border" style="border-color: var(--color-border);">
                        <img
                          src={e.photo.src}
                          alt={e.photo.alt ?? `Photo of ${e.name}`}
                          width="64"
                          height="64"
                          loading="lazy"
                          decoding="async"
                        />
                      </div>
                    ) : (
                      <div
                        class="flex h-16 w-16 items-center justify-center rounded-full border text-sm font-bold"
                        style="border-color: var(--color-border); background: var(--color-surface-alt); color: var(--color-primary);"
                        aria-hidden="true"
                      >
                        {getInitials(e.name)}
                      </div>
                    )}
                  </div>

                  <div class="min-w-0 flex-1">
                    <div class="flex flex-wrap items-center gap-3">
                      <h3 class="text-sm font-bold" style="color: var(--color-neutral-900);">{e.name}</h3>
                      <span class="badge">{e.role}</span>
                    </div>
                    {e.pronouns && <p class="mt-1 text-xs" style="color: var(--color-neutral-500);">{e.pronouns}</p>}
                    {e.credentialsAndTraining?.length ? (
                      <ul class="mt-3 list-disc space-y-1 pl-5 text-xs" style="color: var(--color-neutral-600);">
                        {e.credentialsAndTraining.map((i) => <li>{i}</li>)}
                      </ul>
                    ) : null}
                  </div>
                </div>
              </article>
            ))}
          </div>
        </div>
      )}
    </div>
  </div>
</Layout>
