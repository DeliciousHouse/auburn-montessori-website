---
import Layout from '../layouts/Layout.astro';
import calendar from '../data/calendar.json';

const hasPdf = calendar.pdfPath && calendar.pdfPath.length > 0;
const hasKeyDates = calendar.keyDates && calendar.keyDates.length > 0;
---

<Layout
  title="Calendar"
  description="School calendar information for Auburn Montessori School - The Children's House."
  heroTitle="School Calendar"
  heroLead="Key dates, closures, events, and the full school-year calendar. Confirm with the school for any changes."
>
  {/* Key Dates cards — shown first so parents don't need to open a PDF */}
  {hasKeyDates && (
    <div class="section-band">
      <div class="container-page">
        <h2 class="section-heading">Key Dates</h2>
        <p class="section-subheading">Closures, teacher work days, and important events at a glance</p>
        <div class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-4">
          {calendar.keyDates.map((d: { date: string; label: string; notes?: string }) => (
            <div class="card card-body">
              <div class="text-xs font-semibold uppercase tracking-wider" style="color: var(--color-neutral-500);">{d.date}</div>
              <div class="mt-1 text-sm font-bold" style="color: var(--color-neutral-900);">{d.label}</div>
              {d.notes ? <p class="mt-1 text-xs" style="color: var(--color-neutral-600);">{d.notes}</p> : null}
            </div>
          ))}
        </div>
      </div>
    </div>
  )}

  <div class="section-band-alt">
    <div class="container-page grid gap-8 lg:grid-cols-3">
      {/* PDF embed */}
      <div class="lg:col-span-2">
        {hasPdf ? (
          <div>
            <div class="flex flex-wrap items-center justify-between gap-3">
              <h2 class="section-heading">Full Calendar (PDF)</h2>
              {calendar.lastUpdated ? <span class="badge">Updated {calendar.lastUpdated}</span> : null}
            </div>
            <div class="mt-4 overflow-hidden rounded-xl border bg-white shadow-sm" style="border-color: var(--color-neutral-200);">
              <iframe
                title="School year calendar PDF"
                src={`${calendar.pdfPath}#view=FitH`}
                class="h-[70vh] w-full"
                loading="lazy"
              ></iframe>
            </div>
            <div class="mt-3 flex flex-wrap gap-3">
              <a class="btn btn-primary btn-sm btn-icon" href={calendar.pdfPath} download>
                <svg width="14" height="14" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M12 5v14m0 0l-5-5m5 5l5-5M5 19h14"/></svg>
                Download PDF
              </a>
            </div>
            <p class="mt-2 text-xs" style="color: var(--color-neutral-500);">
              If the viewer doesn't load, use the download button.
            </p>
          </div>
        ) : (
          <div class="callout callout-info">
            <div class="callout-title">Calendar PDF Coming Soon</div>
            <div class="callout-body">The school-year calendar PDF will be posted here when available.</div>
          </div>
        )}
      </div>

      {/* Online Calendar + Quick actions */}
      <div class="space-y-5">
        <div class="card card-body">
          <h3 class="text-sm font-bold" style="color: var(--color-neutral-900);">Online Calendar</h3>
          <p class="mt-2 text-sm" style="color: var(--color-neutral-600);">View the live events calendar on the school website.</p>
          <a
            class="btn btn-outline btn-sm btn-icon mt-3"
            href={calendar.externalCalendarUrl}
            target="_blank"
            rel="noopener noreferrer"
          >
            View Events ↗
          </a>
        </div>

        <div class="card card-body">
          <h3 class="text-sm font-bold" style="color: var(--color-neutral-900);">Questions?</h3>
          <p class="mt-2 text-sm" style="color: var(--color-neutral-600);">Confirm dates and closures with the school office.</p>
          <a class="btn btn-ghost btn-sm mt-3" href="/contact">Contact Us</a>
        </div>
      </div>
    </div>
  </div>
</Layout>
